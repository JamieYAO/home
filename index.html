<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Home : my index">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <script src="javascripts/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="javascripts/node_modules/react/dist/react.js"></script>
    <script src="javascripts/node_modules/react-dom/dist/react-dom.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdn.wilddog.com/js/client/current/wilddog.js"></script>
<!--
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.js"></script> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
-->

    <style>
	html {
		background: url(http://hbfile.b0.upaiyun.com/img/home/banner/6379c260e25b6a60a45c889d9d6481b0c837bee9d0dd2);
		background-attachment: fixed;
	}
	.single-content {
		border-bottom: 1px solid gray;
	}
	#motto {
		color: white;
		text-align: center;
	}
	#add {
		position: absolute;
		right: 0;
		top: 0;
	}
	body {
		background: none;
	}
	#header_wrap {
		opacity: .7;
	}
	#footer_wrap {
		opacity: .7;
	}
	#main_content_wrap {
		opacity: .9;
	}
	#input-wrapper {
	}
	.none {
		display: none;
	}
	.block {
		display: block;
	}
    </style>

    <title>My Note Book</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/JamieYAO/home">View on GitHub</a>
        </header>
	<div id="motto">有句话特别好：当我坐下来开始写作（码代码）的时候，我不会去问自己，“我要说点什么呢？”而是问自己，“我想要弄清楚什么呢？”</div>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Home maintained by <a href="https://github.com/JamieYAO">JamieYAO</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>

  <script type='text/babel'>
	var ref = new Wilddog("https://wild-boar-92305.wilddogio.com/article");
	//ref.child('test_sync').set("hello world");
	var g_target;

	var AddWrapper = React.createClass({
		getInitialState: function() {
			return {
				isShowInput: false,
				opacity: 1.0
			};
		},
		componentDidMount: function () {
			var timer = function() {
				this.timer = setInterval(function () {
					var opacity = this.state.opacity;
					opacity -= .1;
					if (opacity < 0.1) {
						clearInterval(this.timer)
						timerUp();
					}
					this.setState({
						opacity: opacity
					});
				}.bind(this), 100);
			}.bind(this)
			var timerUp = function() {
				this.timerUp = setInterval(function () {
					var opacity = this.state.opacity;
					opacity += .1;
					if (opacity > 1.0) {
						clearInterval(this.timerUp)
						timer();
					}
					this.setState({
						opacity: opacity
					});
				}.bind(this), 100);
			}.bind(this)
			timer();
		},
		handlerAdd: function(e) {
			this.setState({
				isShowInput: !this.state.isShowInput
			})
		},
		handlerComfirm: function(e) {
			var currentTime = new Date().toLocaleString();
			var title = this.refs.title.value;
			var content = this.refs.content.value;
			ref.push({
				'title': title,
				'time': currentTime,
				'content': content
			});
			this.refs.title.value = "";
			this.refs.content.value = "";
			this.handlerAdd();
		},
		render: function() {
			var display;
			if (this.state.isShowInput) {
				display = "block"
			} else {
				display = "none"
			}
			return  <div id="add">
					<button id="add-btn" onClick={this.handlerAdd} style={{float: 'right', opacity: this.state.opacity}}>ADD</button>
					<div id="input-wrapper" className={display}>
						<input id="title" placeholder="title" ref="title"></input>
						<input id="content" placeholder="content" ref="content"></input>
						<button id="add-btn" onClick={this.handlerComfirm}>Comfirm</button>
					</div>
				</div>
		}
	});
	
	var Article = React.createClass({
		handlerRemove: function(e) {
			console.log(this.props.id_key);
			var url = "https://wild-boar-92305.wilddogio.com/article/" + this.props.id_key;
			console.log(url);
			var refRemove = new Wilddog(url);
			refRemove.set(null);
		},
		render: function() {
			return <div className="single-content">
					<p>{this.props.data.title}</p>
					<p>{this.props.data.time}</p>
					<p>{this.props.data.content}</p>
					<button onClick={this.handlerRemove}> X </button>
				</div>
		}
	});

	var ArticleWrapper = React.createClass({
		getInitialState: function() {
			return {
				data: {},
				loaded: false
			};
		},
		componentDidMount() {
			this.fetchData();
		},
		fetchData: function() {
			ref.orderByChild('time').on("value", function(snapshot) {
				this.setState({
					data: snapshot.val(),
					loaded: true
				})
			}.bind(this))		
		},
		render: function() {

			if (!this.state.loaded) {
				return (
					React.createElement('h1', {className: "loading-hint"}, 'Loading ...')
				       );
			}

			var rows = [];

			for(var k in this.state.data) {
				rows.push(React.createElement(Article, {data : this.state.data[k], id_key: k}));
			}

			
			return 	<div>
					{rows}
					<AddWrapper />
				</div>;
		}
	});
	ReactDOM.render(
		<ArticleWrapper />,
		document.getElementById('main_content')
	);
        
  </script>
</html>
