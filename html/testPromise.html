<html>
<head>
<meta charset='utf-8'/>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
</head>
<a href="https://github.com/JamieYAO/home/blob/gh-pages/testPromise.html">SOURCE CODE</a>
<div id="log"></div>
<script>
    'use strict';
    var promiseCount = 0;
    function testPromise() {
        var thisPromiseCount = ++promiseCount;

        var log = document.getElementById('log');
        log.insertAdjacentHTML('beforeend', thisPromiseCount + ') Started (<small>Sync code started</small>)<br/>');

        var p1 = new Promise(function (resolve, reject) {
            log.insertAdjacentHTML('beforeend', thisPromiseCount + ') Promise started (<small>Async code started</small>)<br/>');
            window.setTimeout(function () {
		resolve(thisPromiseCount);
		//reject(thisPromiseCount + "reason");
            }, Math.random() * 2000 + 1000);
        });
	p1.then(function (resolve) {
	    const resolve1 = resolve;
	    const p2 = new Promise(function (resolve, reject) {
		resolve('return p2 给调用者使用(' + resolve1 + ')' )
	    })
	    return p2;// 给调用者使用
            //log.insertAdjacentHTML('beforeend', val + ') Promise fulfilled (<small>Async code terminated</small>)<br/>');
        })
	.then(function (p2) {
            log.insertAdjacentHTML('beforeend', p2 + ') Promise fulfilled (<small>Async code terminated</small>)<br/>');
	})
	.catch(function (reason) {
	    log.insertAdjacentHTML('beforeend', 'Promise rejected ('+reason+')<br/> ');
	});
        log.insertAdjacentHTML('beforeend', thisPromiseCount + ') Promise made (<small>Sync code terminated</small>)<br/><br/>');
    }
    testPromise();
    testPromise();
    testPromise();
</script>
</html>
